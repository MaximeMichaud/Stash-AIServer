services:
  backend_dev:
    build:
      context: ./backend
      target: dev
    container_name: ai-overhaul-backend-dev
    ports:
      - "8000:8000"
    volumes:
      - ./backend/stash_ai_server:/app/stash_ai_server:rw
      - ./backend/alembic:/app/alembic:rw
      - ./backend/alembic.ini:/app/alembic.ini:ro
      - ./backend/data:/app/data
      - ./backend/plugins:/app/plugins:rw
    env_file:
      - ./backend/config.env
    command: python -m stash_ai_server.dev_entrypoint

  # If you prefer to run the dev container from the published image (no live reload),
  # replace `build:` above with:
  # image: ghcr.io/skier233/stash-ai-server:latest

  backend_prod:
    image: ghcr.io/skier233/stash-ai-server:latest
    container_name: ai-overhaul-backend-prod
    ports:
      - "8000:8000"
    env_file:
      - ./backend/config.env
    volumes:
      - ./backend/data:/app/data:rw
      - ./backend/plugins:/app/plugins:rw
